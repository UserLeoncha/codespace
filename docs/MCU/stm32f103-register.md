# stm32f103-book
a common stm32f103 book

## tigs
`auther:Leoncha凉茶`
`生存与发展是第一要务`

## abstract
这是一本为大学生，单片机初学者以及对学习单片机感到无力的人所写的书，如果你不知道该怎么学习，对学习产生了消极情绪，对自己的能力期望过高，请耐心读下去。

下面是模块清单，初学者请跳过：STM32F103芯片、F103板上资源、ARM Cortex-M3架构相关知识（ARM系列处理器的特点，中断触发，寄存器，总线结构）、Keil编译器、STMCubeMX、Linux下开源开发库libopencm3、ST-Link/J-Link、DEBUG、UCOSII、RTOS、SRAM、FLASH、E2PROM、ARM架构采用哈弗架构、改进哈弗架构、冯诺伊曼架构、看门狗（软件开门狗和硬件看门狗）、RTC时钟、SD卡、PWM波（PWM电机、DAC）、LED/LCD、触摸板库、HAL库、CMSIS
STM32内容：GPIO八种模式、时钟树（四个时钟源，两个高速时钟源，两个低速时钟源，一个PLL时钟源，芯片和板上各有一套高低速时钟源）、NVIC中断（四个特点）、Timer（三种定时器）、总线结构（AHB、APB1、APB2，其中APB时钟频率是AHB的二分之一）、通信协议（UART、USART、USMART、I2C、SPI、1-wire、RS232、RS485、USB、2.4GHz、bt、esp8266、zigbee、lora、nb-iot）、流水线

## 单片机的核心问题：什么是单片机？
在本文开始之前，我要提出两个问题：什么是单片机？单片机最小系统的三要素是什么？

标准答案是：单片机是一种**集成电路芯片**。单片机最小系统三要素包括电源电路、晶振电路、复位电路。

单片机是电子电路的一种变体，单片机与电子电路之间的区别就是，单片机有集成电路芯片，也是一块通用芯片。

我们知道，单片机是一块PCB板，有一块或多块主控芯片，一些必备的模块和一些外设，传感器组成。有时这些板子上还带有裸露的接口，这是我们就可以自由的把一些传感器连接到IO口上。


这两个问题划清了单片机与普通电路的区别，圈定了单片机的范围，也让单片机在我们的想象中有了形状

对于初学者来说，STM32系列单片机内容繁杂，难以为继，尤其是51都没有搞清楚的小朋友。这是一个致命的问题。首先，要搞清楚STM32由哪些部分构成，都有什么作用，有哪些应用？对于软件、云服务、物联网、机器人，STM32在这些行业中处于怎样的生态位，起到什么作用。

STM32系列单片机内容繁杂，难以为继，尤其是51都没有搞清楚的小朋友。这是一个致命的问题。首先，要搞清楚STM32由哪些模块组成，可以发挥什么作用，可以搭建什么应用？对于软件、云服务、物联网、机器人以及家用电器领域，STM32在单片机行业中处于怎样的生态位？起到什么作用？

知识是信息与相互关系的集合。信息是指经验与总结，是符号；相互关系是指逻辑关系，因果关系。如果想通过前人的总结学会知识，只接收信息是不够的，当你开始询问为什么时，就是在请求逻辑关系与因果关系。

笔者才疏学浅，只能为迷路的初学者指明方向，剩下的一切都要大家自己学习。

## 为什么单片机会运行？
好吧，还是不得不讲这个，任何一个不明白单片机启动过程的单片机工程师都是次品工程师，我不知道读者现在对电子电路，计算机以及微机原理了解多少，首先我要告诉你们单片机编程的基本特点：

是这样的，上面我们提到了单片机的两个核心问题：单片机是什么以及单片机最小系统三要素。这两个问题实在是太重要了，作为未来的单片机工程师，你们必须明白，单片机作为现代电子工业的产物，芯片、晶振电路、电源电路、复位电路分别给单片机带来了哪些性质。

单片机代码由初始化和循环构成，对于结构简单，软件简单，计算简单的单片机，就像是一个玩具火车跑道，从起点出发，在一个圆形轨道上不停的绕着圈，当你按下复位按键的那一刻，火车就回到了起点，so easy。当然，起点未必在圆形轨道上，但起点必定通往圆形轨道。

在STM32F103ZET6芯片中，存在两种存储介质，一个是大小为256KB的SRAM，一个是大小为512KB的Flash芯片，在编译project后，keil编译器会自动安排程序应当转载的地址。

#### 单片机启动流程
任何与C语言有关的系统都离不开堆栈。
#### GPIO详解
GPIO是一种常见的接口规范，由八种工作状态，四种输入，四种输出。

##### 上拉输入
在浮空状态下，电平信号为高电平
##### 下拉输入
##### 浮空输入
GPIO的电平信号直接写入数据输入寄存器，在引脚悬空的状态下，该端口的电平状态时随机的。
##### 模拟输入
在模拟状态下，IO端口上的模拟信号直接模拟输入到片上外设模块，比如ADC模块。

##### 推挽输出
使用了两个MOS管，高低电平分别使用上下两个MOS管。使用高电平时PMOS开启，NMOS截止；使用低电平时，PMOS截止，NMOS开启。推挽输出具有较高的驱动能力和较快的切换速度，适用于高速数字信号的传输。

##### 开漏输出
只使用了一个MOS管，只能提供低电平
当MOS管开启，端口输出电平拉低；MOS管截至，VCC提供电压，3.3V。
当电流较大，功率较大，优势。

##### 复用推挽输出
##### 复用开漏输出
将输出转发到其他端口或者外设。


#### 推挽输出与开漏输出的区别是什么？
1.开漏输出功能高电平由上拉电路实现，如果把多个开漏端口接到同一个点上，需要同时拉低所以端口才能实现低电平，“与”功能。
2.开漏输出不能输出高电平，高点平需要通过上拉电路（VCC）实现，详解查看MOS管。
3.开漏输出可以承载较高的电压和电流。
4.


#### 复用功能是什么？

#### HAL详解是什么？

#### Delay函数是什么？为什么会有delay函数？

### 代码流程逻辑详解

#### 解构STM32F103 project结构
以使用HAL库的项目为例，如果你双击打开一个名为project的STM32项目文件，可以发现在project文件夹中有多个子文件夹，包括USER,CORE,HALLIB,SYSTEM,HARDWARE,OBJ等，有时还会有一个readme.txt/readme.md，这些文件夹的作用是什么呢？为什么要分文件夹存放不同的文件？

如果你要使用keil打开一个project，你需要做的是先找到这个project的.uvprojx文件，这是一个project的“头”，就像是树的根节点。然后呢，也许你可以看到在keil界面左侧，文件夹目录结构中，这个结构与在windows桌面上打开的文件夹结构并不相同。没错，这个文件夹是用户（就是你自己）在集成开发环境（IDE   就是keil）中自定义的，对于这一结构，并无过多要求，工程师可以根据自己的理解修改，菜鸟想要探索记得做好备份。

在各大嵌入式教程中，都会手把手教你们学习，使用，这是会制造误区，学习从自身的行动开始，不要把你们的希望寄托在具有权威与经验的教育机构身上，我希望你们的学习具有攻击性。学习应当从质疑开始。

在abstract中我们提到了，单片机有两个根本问题：1.单品机是什么？2.单片机最小系统三要素包括什么？

#### init

##### 设置GPIO状态
开启GPIO时钟
2MHz，10MHz，50MHz三种
##### 初始化外设
Project/USER/main.c

Project/HARDWARE/led.c le
